{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["file:///home/user/agenko-nextjs/src/app/api/contact/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\n\n// The URL for your n8n webhook\nconst WEBHOOK_URL = 'https://webhooks-n8n.studiodental.digital/webhook/2acbe97c-2784-4283-9e76-72ae7051e1e0';\n\nexport async function POST(request: Request) {\n  try {\n    const body = await request.json();\n    const { nome, whatsapp, email } = body;\n\n    // --- SERVER-SIDE VALIDATION ---\n    if (!nome || typeof nome !== 'string' || nome.trim().length < 2) {\n      return NextResponse.json({ message: 'Nome inválido fornecido.' }, { status: 400 });\n    }\n    if (!email || typeof email !== 'string' || !email.includes('@') || !email.includes('.')) {\n      return NextResponse.json({ message: 'Email inválido fornecido.' }, { status: 400 });\n    }\n    if (!whatsapp || typeof whatsapp !== 'string' || whatsapp.replace(/\\D/g, '').length < 10) {\n      return NextResponse.json({ message: 'WhatsApp inválido fornecido.' }, { status: 400 });\n    }\n\n    // --- PREPARE DATA FOR WEBHOOK ---\n    // --- FIX for Headers Error: Get headers directly from the request object ---\n    const userAgent = request.headers.get('user-agent') || 'Unknown';\n    const pageUrl = request.headers.get('referer') || 'Unknown';\n\n    const webhookPayload = {\n      nome: nome.trim(),\n      email: email.trim(),\n      whatsapp: whatsapp.replace(/\\D/g, ''),\n      page_url: pageUrl,\n      timestamp: new Date().toISOString(),\n      source: 'nextjs_contact_form_v1',\n      user_agent: userAgent\n    };\n\n    console.log('Forwarding to webhook:', webhookPayload);\n\n    // --- SEND DATA TO EXTERNAL WEBHOOK ---\n    const webhookResponse = await fetch(WEBHOOK_URL, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Accept': 'application/json'\n      },\n      body: JSON.stringify(webhookPayload)\n    });\n\n    if (!webhookResponse.ok) {\n      console.error(`Webhook failed with status: ${webhookResponse.status}`, await webhookResponse.text());\n      return NextResponse.json({ message: 'Ocorreu um erro ao processar sua solicitação.' }, { status: 502 });\n    }\n\n    console.log('Webhook submission successful.');\n\n    return NextResponse.json({ message: 'Formulário enviado com sucesso!' }, { status: 200 });\n\n  } catch (error) {\n    console.error('Error processing form submission:', error);\n    return NextResponse.json({ message: 'Erro ao processar o envio do formulário.' }, { status: 500 });\n  }\n}"],"names":[],"mappings":";;;;AAAA;;AAEA,+BAA+B;AAC/B,MAAM,cAAc;AAEb,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,KAAK,EAAE,GAAG;QAElC,iCAAiC;QACjC,IAAI,CAAC,QAAQ,OAAO,SAAS,YAAY,KAAK,IAAI,GAAG,MAAM,GAAG,GAAG;YAC/D,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAA2B,GAAG;gBAAE,QAAQ;YAAI;QAClF;QACA,IAAI,CAAC,SAAS,OAAO,UAAU,YAAY,CAAC,MAAM,QAAQ,CAAC,QAAQ,CAAC,MAAM,QAAQ,CAAC,MAAM;YACvF,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAA4B,GAAG;gBAAE,QAAQ;YAAI;QACnF;QACA,IAAI,CAAC,YAAY,OAAO,aAAa,YAAY,SAAS,OAAO,CAAC,OAAO,IAAI,MAAM,GAAG,IAAI;YACxF,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAA+B,GAAG;gBAAE,QAAQ;YAAI;QACtF;QAEA,mCAAmC;QACnC,8EAA8E;QAC9E,MAAM,YAAY,QAAQ,OAAO,CAAC,GAAG,CAAC,iBAAiB;QACvD,MAAM,UAAU,QAAQ,OAAO,CAAC,GAAG,CAAC,cAAc;QAElD,MAAM,iBAAiB;YACrB,MAAM,KAAK,IAAI;YACf,OAAO,MAAM,IAAI;YACjB,UAAU,SAAS,OAAO,CAAC,OAAO;YAClC,UAAU;YACV,WAAW,IAAI,OAAO,WAAW;YACjC,QAAQ;YACR,YAAY;QACd;QAEA,QAAQ,GAAG,CAAC,0BAA0B;QAEtC,wCAAwC;QACxC,MAAM,kBAAkB,MAAM,MAAM,aAAa;YAC/C,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,UAAU;YACZ;YACA,MAAM,KAAK,SAAS,CAAC;QACvB;QAEA,IAAI,CAAC,gBAAgB,EAAE,EAAE;YACvB,QAAQ,KAAK,CAAC,CAAC,4BAA4B,EAAE,gBAAgB,MAAM,EAAE,EAAE,MAAM,gBAAgB,IAAI;YACjG,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAgD,GAAG;gBAAE,QAAQ;YAAI;QACvG;QAEA,QAAQ,GAAG,CAAC;QAEZ,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAkC,GAAG;YAAE,QAAQ;QAAI;IAEzF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qCAAqC;QACnD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAA2C,GAAG;YAAE,QAAQ;QAAI;IAClG;AACF","debugId":null}}]
}